# 達人に学ぶDB設計指南書

# Section.1

## データと情報
Googleは世界中のWebサイトを巡回し、各サイトの一時的なコピー（キャッシュ）を自社のサーバーに保存して、それをもとにページランクを算出している。また、Amazonは購買履歴データを使って「おすすめ商品」をプッシュする。このように、私たちが普段使っているようなサービスでは必ず「データ」を用いる。「データベース」はデータの集まりであり、それを管理するためのシステムとして「DBMS（Database Management System）」と呼ぶ。

データとは、<strong>ある形式（フォーマット）に揃えられた事実</strong>のことである。ある人物をデータ化しようとすると、性別、身長、体重などさまざまな属性が考えられる。一方で、情報とはデータと文脈を合わせてはじめて生まれるものを指す。

## データベースの代表的なモデル
データを保持するフォーマットは複数あり、以下のような例が挙げられる。
#### リレーショナルデータベース(RDB)
関係データベースともよばれ、業界でもっとも広く使われている。書籍で扱っているものがこれ。

### オブジェクト指向データベース(OODB)
データを「オブジェクト」として保存するフォーマット。

### XMLデータベース(XMLDB)
Web上でやり取りされるデータの形式にXMLが普及している。リレーショナルデータベースが不得意としている階層構造のデータの扱いを得意としている。

### キー・バリュー型ストア(KVS)

### 階層型データベース
データを木構造で表現するデータベース。一世代前の主流データベースだったがRDBの普及によって一般的には使用されなくなった。

## 設計工程と開発モデル
システム開発の進め方には、大きく分けて二つの方法がある。一つがウォーターフォールモデル、もう一つが_プロトタイピングモデル_。

### ウォーターフォールモデル
要件定義→設計→開発→テスト、というように一つずつ工程を踏んで、段階的にシステムを作っていく。滝が逆流することがないように基本的に工程が逆戻りすることはない。そのぶん各工程がきっちりしていないと大変なことになる。

### プロトタイピングモデル
小さな試作品を作って顧客やユーザーに見せてフィードバックをもらい、それを取り入れた形で改良版を作って顧客やユーザーに見せて…というサイクルを繰り返す循環的な開発手段。意思疎通の齟齬を防げる一方
で変更を繰り返すうちに収集がつかなくなる可能性があるというデメリットも。普通は小規模なシステムに適用される。
このモデルを応用した「アジャイル」と呼ばれるモデルもある。これは特にサービスが提供を迅速に行うことが死活的に重要なWeb系システムの開発で利用される。


## 設計工程とデータベース
４つの基本工程のうち、本書がフォーカスを当てるのは設計工程。この工程にはさらに多くのサブ工程が含まれている。
ソフトウェアの提供する機能を決めるアプリケーション（AP）設計、ユーザが使用する画面などのユーザインターフェース設計などが該当する。
本書では、サブ工程の一つである「データ設計」、特にデータベースに保持するデータの設計について説明する。

### DOAとPOA
近年のソフトウェア開発ではデータ中心アプローチ(Data Oriented Approach: DOA)という考え方が主流となっている。これはシステムを作る際、プログラムよりも前にデータの設計から始める方法論である。逆に、プログラムから設計をしていくのがプロセス中心アプローチ(Process Oriented Approach)である。POAではプロセス、つまり業務処理ごとにデータ設計を行うと、要件変更や同じデータを個別にもつという冗長性が生じるなどのデメリットがある。それを解決するためにDOAが登場した。

### ３層スキーマ
スキーマとは、データベースの設計においてはデータベースのデータ構造やフォーマットという意味で使う。データベースの設計のステップは、このスキーマのレベルと密接に結びついている。スキーマは一般的に三つのレベルに分ける。
1. 外部スキーマ（外部モデル） = ビューの世界
2. 概念スキーマ（論理データモデル） = テーブルの世界
3. 内部スキーマ（物理データモデル） = ファイルの世界

この三つのスキーマに基づいてシステムを記述したモデルを「<strong>3層スキーマモデル</strong>」という。

#### 1. 外部スキーマ
外部スキーマとは、「<strong>ユーザーからみたデータベースの姿</strong>」のことである。データベースのオブジェクトとしてはビューが担当する。このスキーマは、データベースだけでなく、画面のユーザーインターフェースや入力データなど、ユーザーから見える「システムの姿」の一部である、ということもできる。

#### 2. 概念スキーマ
データベースに保持するデータの要素および、データ同士の関係を記述するスキーマ。

#### 3. 内部スキーマ
概念スキーマで定義された論理データモデルを、具体的にどのようにDBMS内部に格納するかを定義するスキーマ。

### 概念スキーマとデータ独立性
概念データモデルが存在することによって、外部スキーマと内部スキーマを独立させることができる。外部スキーマと内部スキーマが直接結びついていると、変更が起こるとどちらも変更する必要な場合があり、変更にコストがかかる。しかし、概念スキーマを挟むことで、変更に強くなる。



## 演習
1-1
1. PostgreSQL 15.1

1-2
問題1. 夜間、たとえば0:00に何らかの処理を行うというプログラムを行ってい他場合、処理するデータを分割することで負荷を下げることができると考えられる。

問題2. 要件に漏れがあったので、顧客に対して変更を提案し、その後3層スキーマの設計を変えて足りないデータを追加する。

