# データベースとパフォーマンス
DB設計というと、論理設計に目を奪われがちだが、それだけでは十分なパフォーマンスを確保するには不十分である。
本章ではインデックスと統計情報という二つの観点を通してハイパフォーマンスを実現する方法を考える。

インデックスを使う主な理由理由↓

## 6-2. インデックス設計
インデックスはSQLのパフォーマンス改善のための非常にポピュラーな手段である。

1. アプリケーション透過的
インデックスを使うかどうかはDBMSが自動的に判断する。インデックスを使う場合は単純にデータベース側にインデックスを作成すればいいだけなので、アプリケーションプログラムを変更する必要はない。
このように「存在を意識しなくても良い」と言う性質を「透過性transparency」という。

2. データ透過的
インデックスを作成することでテーブルに格納されているデータの中身が影響を受けることがないし、テーブルの構造も変化することはないため、データ透過的でもある。

3. 大きな性能改善効果
うまく使えば劇的にパフォーマンスを改善することができる。

### B-treeインデックス
B-treeは平衡木。挿入、更新、削除のコストがO(logN)なので、データ数が大きく、かつデータがバラけているようなときに適用すると効果を発揮する。
注意事項
- 主キーおよび一意制約の列には作成不要
- B-treeインデックスは更新性能を劣化させる
- 定期的なメンテナンスが必要（インデックスの再構築など）

## 6-4. 統計情報
### オプティマイザと実行計画
DBMSがSQL文を受け取ると、まずparserが正しい構文かどうかをチェックする。
parserによるチェックが済むと「オプティマイザ」というモジュールへ送られる。
このオプティマイザはDBMSの頭脳とも言うべき重要な役割を担っている。

オプティマイザが実行計画を立てる際、統計情報が必要になる。そこで、オプティマイザは「カタログマネージャ」と言うモジュールに、統計情報の照会をかける。
カタログマネージャは統計情報を管理するモジュールで、例えるなら図書館の司書である。
オプティマイザはたくさんの経路の中から統計情報をもとに最短と思われる経路を選択し、SQL手続きに変換する。その時得られた手続きの手順が、実行計画である。それに従って要約日データであるテーブルへとアクセスできる。

### 統計情報の設計指針

## 演習問題
- ビットマップインデックス
  メリット：カーディナリティが低い場合有効。血液型などは4つしか種類がないので、下図のようなインデックスを貼ることで高速に検索できる。
  デメリット：更新に時間がかかりやすい（新しい値が入った場合データの分だけインデックスを追加しないといけない）。
|レコード番号|1|2|3|4|
|----|----|----|----|----|
|A|0|1|1|0|
|B|1|0|0|0|
|AB|0|0|0|0|
|O|0|0|0|1|
