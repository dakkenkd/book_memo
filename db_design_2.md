# 2章 論理設計と物理設計

## 2-1. 概念スキーマと論理設計

概念スキーマを定義する設計を<strong>論理設計</strong>と呼ぶ。論理設計が物理設計より前に位置しているのは、この設計が物理制約には、原則として依存しないことを示している。

## 論理設計のステップ
(1)エンティティの抽出、(2)エンティティの定義、(3)正規化、(4)ER図の作成、という4つのステップを踏んで設計を行う。

### エンティティの抽出
エンティティは、日本語で「実態」と訳す。現実世界に存在するデータの集合体を指す言葉で、具体的には「顧客」や「社員」「店舗」「車」といった物理的実体をともなったものもあれば、「税」や「会社」「注文履歴」のように物理的実体を伴わない、匂いもなければ触れもしない、単なる概念としてしか存在しないものも含まれる。
RDBではこうした現実世界のエンティティを、最終的いには「テーブル」という物理的単位で格納していくことになる。そのため、まずはシステムのためにどのようなエンティティ（データ）が必要になるかを抽出することが、論理設計の第１ステップになる。

### エンティティの定義
エンティティを抽出した後は、各エンティティがどのようなデータを保持するかを決める必要がある。エンティティは、データを「属性（attribute）」という形で保持する。これは二次元表における「列」と同義と考えても良い。
RDBではテーブルというフォーマットでエンティティを保持するが、各表がどのような「列」を持つか定義するのがこの作業。

ここで重要なのが「キー」という列を定義すること。キーとはある特定の列の値を決定するための列のこと。

### 正規化
正規化（normalization）は、エンティティ（テーブル）について、システムでの利用gあスムーズに行えるようにする作業のこと。

### ER図の作成
ER図は、Entity-Relationship Diagram の略。正規化を行うと、エンティティの数が増える。
正規化はエンティティを細かく分割していく作業であり、それを行う途中でエンティティ同士の関係がわからなくなってしまうことがある。その問題を解決するために考案されたのが、エンティティ同士の関係を表現する図を作成するという方法である。

## 2-2. 内部スキーマと物理設計
物理設計は、論理設計の結果を受けて、データを格納するための物理的な領域や格納方法を決める工程。

## 物理設計のステップ

### テーブル定義
論理設計で定義された概念スキーマをもとに、それをDBMS内部に格納するための「テーブル」の単位に変換していく作業。

### インデックス定義
インデックス（索引）は、RDBにおいてテーブルと並んで重要な概念である。インデックスが重要な役割を果たすのが、非機能の部分、つまりパフォーマンス。

### ハードウェアのサイジング
システムで利用するデータサイズを見積もり、それに十分な容量の記憶装置を選定すること。また、システムが十分な性能を発揮できるようなスペックのCPUやメモリを持ったサーバーを選定すること。
データベースにおいては、データの整合性とパフォーマンスの間に強いトレードオフが存在する。つまり、整合性を高くしようとするとパフォーマンスが犠牲になり、パフォーマンスを追求すると整合性を犠牲にする、という二律背反の原則がある。
DB設計は限られた予算制約の中で、両端の間の平衡点を見つけ出そうとする努力だといっても良い。

#### キャパシティのサイジング
- システムで利用するデータ寮
  データベース内に格納するデータ量は、物理的なテーブル定義およびインデックス定義が終わらないと算出できない。したがって、この作業を実施するには、論理設計の終了が前提条件になる。
  ここまでのデータ寮には、データベース内に格納するテーブル以外にも、テキストや画像などのさまざまな形式のファイルの分も加算する必要がある。


### ストレージの冗長構成

データを失わないためにもできるだけ高い障害耐性を持つようにシステムを構築する必要がある。RAIDはRedundant Array of Independent Disksの略で、日本語に訳すと「独立したディスクの冗長配列」になる。
RAIDは本来システムの信頼性を高めるための技術だが、性能向上という面もある。

- RAID0
  - 別名ストライピング。ただデータを分散して持つだけなので、冗長性は全くない。
- RAID1
  - 別名ミラーリング。2本のディスクに全く同じデータおw持つ。信頼性が上がるが、ディスクの使用効率は悪い。
- RAID5
  - パリティ分散と呼ばれる。データとともに「パリティ」と呼ばれる誤り符号訂正符号を分散して格納する。一本までならパリティから実データを復元させることができる。また、データを分散できるためIO性能の向上も期待できる。
- RAID10
  - 別名「RAID0+1」とも呼ばれる。RAID1とRAID0を組み合わせたもの。信頼性と高速性が期待できるがコストが高い。

実際にどのRAIDを選ぶとなると、できればRAID10がいいが、最低限RAID5はほしいらしい。
